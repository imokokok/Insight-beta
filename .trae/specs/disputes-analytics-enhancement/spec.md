# 仲裁分析页面增强 Spec

## Why
仲裁分析页面作为预言机争议数据的核心分析入口，当前基础功能已实现但存在以下问题：缺少关键的数据筛选功能、争议详情展示不完整、缺少仲裁者深度分析、可视化图表单一、缺少引导性内容。需要进行系统性增强以提升用户对仲裁数据的洞察效率。

## What Changes
- 增加时间范围选择器，支持自定义分析窗口
- 增加协议和链筛选功能
- 增加争议详情弹窗/面板，展示完整争议信息
- 增加争议结果分布可视化（饼图/环形图）
- 增加保证金分布分析图表
- 增加仲裁者排行榜和详细分析
- 增加数据导出格式选择（CSV、Excel）
- 增加新手引导和帮助提示
- 优化移动端响应式布局

## Impact
- Affected specs: oracle-disputes-analytics, data-visualization, user-experience
- Affected code: 
  - `src/features/oracle/analytics/disputes/components/` - 组件增强
  - `src/features/oracle/analytics/disputes/hooks/` - 增加筛选逻辑
  - `src/features/oracle/analytics/disputes/types/disputes.ts` - 类型扩展

---

## 当前页面功能评估

### 已实现功能 ✅

| 功能模块 | 状态 | 说明 |
|---------|------|------|
| 概览 Tab | ✅ 完整 | 显示争议趋势图表、最近活动列表 |
| 争议列表 Tab | ✅ 完整 | 显示所有争议、支持搜索和状态筛选 |
| 仲裁者 Tab | ⚠️ 部分 | 显示仲裁者列表，但详情展示简陋 |
| 自动刷新 | ✅ 完整 | 支持自定义刷新间隔、倒计时显示 |
| 数据导出 | ⚠️ 部分 | 仅支持 JSON 格式导出 |
| 错误处理 | ✅ 完整 | 错误提示、重试机制 |
| 加载状态 | ✅ 完整 | Skeleton 加载、刷新指示器 |
| 状态筛选 | ✅ 完整 | 支持 All/Active/Resolved 筛选 |

### 缺失功能 ❌

| 功能模块 | 优先级 | 说明 |
|---------|--------|------|
| 时间范围选择器 | P0 | 当前固定30天，需支持自定义时间范围 |
| 协议/链筛选 | P0 | 无法按协议或链筛选数据 |
| 争议详情弹窗 | P0 | 选中争议后无详细展示面板 |
| 争议结果分布图 | P1 | 缺少成功/失败分布可视化 |
| 保证金分析图表 | P1 | 缺少保证金分布和趋势分析 |
| 仲裁者排行榜 | P1 | 缺少可视化的仲裁者排名 |
| 导出格式选择 | P1 | 仅支持 JSON，需增加 CSV、Excel 格式 |
| 新手引导 | P2 | 缺少帮助提示，新用户理解成本高 |
| 争议预测 | P2 | 缺少基于历史数据的争议趋势预测 |
| 实时告警设置 | P3 | 缺少新争议告警功能 |

---

## 与其他页面的功能区分

### 偏差分析页面（已实现）
- ✅ 时间范围选择器
- ✅ 协议筛选
- ✅ 趋势图表
- ✅ 异常列表
- ✅ 数据导出

### Dashboard 页面（已实现）
- ✅ 统计卡片
- ✅ 价格趋势图表
- ✅ 协议对比图表
- ✅ 延迟分析图表

### 仲裁分析页面（需增强，避免重复）
- ❌ 时间范围选择器 → **复用偏差分析组件**
- ❌ 协议/链筛选 → **仲裁特有：支持多协议、多链同时筛选**
- ❌ 争议详情弹窗 → **仲裁特有功能**
- ❌ 争议结果分布图 → **仲裁特有功能**
- ❌ 保证金分析图表 → **仲裁特有功能**
- ❌ 仲裁者排行榜 → **仲裁特有功能**

---

## ADDED Requirements

### Requirement: 时间范围选择器
系统 SHALL 提供时间范围选择器，允许用户自定义仲裁数据分析的时间窗口。

#### Scenario: 选择预设时间范围
- **WHEN** 用户点击时间范围选择器
- **THEN** 显示预设选项：24小时、7天、30天、90天、自定义

#### Scenario: 自定义时间范围
- **WHEN** 用户选择"自定义"选项
- **THEN** 显示日期时间选择器，允许选择开始和结束时间

### Requirement: 协议和链筛选功能
系统 SHALL 提供协议和链筛选功能，允许用户按预言机协议和区块链网络筛选仲裁数据。

#### Scenario: 单协议筛选
- **WHEN** 用户选择特定协议（如 UMA）
- **THEN** 页面仅显示该协议相关的仲裁数据

#### Scenario: 多协议筛选
- **WHEN** 用户选择多个协议
- **THEN** 页面显示所选协议的对比数据

#### Scenario: 链筛选
- **WHEN** 用户选择特定链（如 Ethereum）
- **THEN** 页面仅显示该链上的仲裁数据

### Requirement: 争议详情弹窗
系统 SHALL 提供争议详情弹窗/面板，展示完整的争议信息。

#### Scenario: 查看争议详情
- **WHEN** 用户点击争议列表中的争议项
- **THEN** 显示争议详情弹窗，包含：
  - 争议声明完整内容
  - 断言者和争议者地址（可点击跳转）
  - 保证金详情（断言保证金、争议保证金）
  - 时间线（提议时间、争议时间、解决时间）
  - 争议结果（如已解决）
  - 交易哈希（可点击跳转区块浏览器）
  - 相关协议和链信息

#### Scenario: 查看争议历史
- **WHEN** 用户在争议详情弹窗中点击"查看历史"
- **THEN** 显示该争议相关的历史事件列表

### Requirement: 争议结果分布可视化
系统 SHALL 提供争议结果分布的可视化图表。

#### Scenario: 查看结果分布
- **WHEN** 用户在概览 Tab 中
- **THEN** 显示争议结果分布饼图/环形图，展示：
  - 活跃争议数量
  - 成功解决争议数量
  - 失败争议数量

#### Scenario: 按协议查看分布
- **WHEN** 用户点击分布图中的协议标签
- **THEN** 显示该协议的争议结果分布

### Requirement: 保证金分析图表
系统 SHALL 提供保证金分布和趋势分析图表。

#### Scenario: 查看保证金分布
- **WHEN** 用户在概览 Tab 中
- **THEN** 显示保证金分布图表，展示：
  - 不同金额区间的争议数量
  - 总保证金趋势变化

#### Scenario: 查看保证金统计
- **WHEN** 用户悬停在图表上
- **THEN** 显示该区间的详细统计数据

### Requirement: 仲裁者排行榜
系统 SHALL 提供可视化的仲裁者排行榜。

#### Scenario: 查看仲裁者排名
- **WHEN** 用户在仲裁者 Tab 中
- **THEN** 显示仲裁者排行榜，包含：
  - 排名位置
  - 仲裁者地址
  - 总争议数
  - 成功率
  - 总收益
  - 趋势指示器（上升/下降）

#### Scenario: 查看仲裁者详情
- **WHEN** 用户点击排行榜中的仲裁者
- **THEN** 显示该仲裁者的详细分析面板：
  - 历史争议列表
  - 成功率趋势图
  - 常参与协议分布
  - 收益趋势图

### Requirement: 增强数据导出
系统 SHALL 支持多种数据导出格式。

#### Scenario: 导出为 CSV
- **WHEN** 用户点击导出按钮并选择 CSV 格式
- **THEN** 下载包含当前视图数据的 CSV 文件

#### Scenario: 导出为 Excel
- **WHEN** 用户点击导出按钮并选择 Excel 格式
- **THEN** 下载包含当前视图数据的 Excel 文件

### Requirement: 新手引导系统
系统 SHALL 提供新手引导和帮助提示功能。

#### Scenario: 首次访问引导
- **WHEN** 用户首次访问仲裁分析页面
- **THEN** 显示页面功能介绍引导

#### Scenario: 帮助提示
- **WHEN** 用户悬停在指标或图表上
- **THEN** 显示该指标的含义说明

### Requirement: 争议预测分析
系统 SHALL 提供基于历史数据的争议趋势预测。

#### Scenario: 查看趋势预测
- **WHEN** 用户在概览 Tab 中
- **THEN** 显示未来7天的争议趋势预测线

---

## MODIFIED Requirements

### Requirement: 页面布局优化
原有的页面布局 SHALL 增加引导性内容和快速操作入口。

**变更详情**：
- 在页面顶部增加关键指标概览卡片
- 增加快速操作按钮区域
- 优化 Tab 切换的视觉反馈
- 增加筛选区域

### Requirement: 仲裁者详情展示增强
原有的仲裁者详情展示 SHALL 增加更多分析维度。

**变更详情**：
- 增加仲裁者成功率趋势图
- 增加常参与协议分布图
- 增加收益趋势图
- 增加历史争议列表

---

## UI/UX 改进建议

### 1. 页面入口优化
- **欢迎区域**：简要介绍仲裁分析功能
- **关键洞察卡片**：显示今日关键发现（如：活跃争议数、待解决保证金总额）
- **快捷操作入口**：常用操作一键直达

### 2. 数据可视化增强
- **争议结果分布图**：环形图展示成功/失败/活跃分布
- **保证金热力图**：展示不同协议、不同金额区间的争议分布
- **仲裁者雷达图**：多维度展示仲裁者能力

### 3. 交互体验优化
- **争议详情侧边栏**：点击争议后从右侧滑出详情面板
- **实时数据动画**：数据更新时的平滑过渡
- **操作反馈**：操作后的即时视觉反馈

### 4. 信息架构优化
- **面包屑导航**：明确当前位置
- **数据来源说明**：标注数据来源和更新时间
- **指标解释**：关键指标的含义说明

---

## 技术实现建议

### 组件结构优化
```
disputes/
├── components/
│   ├── filters/              # 新增：筛选组件
│   │   ├── TimeRangeSelector.tsx    # 复用 deviation 组件
│   │   ├── ProtocolChainFilter.tsx  # 新增
│   │   └── index.ts
│   ├── charts/               # 新增：图表组件
│   │   ├── DisputeResultChart.tsx   # 争议结果分布图
│   │   ├── BondDistributionChart.tsx # 保证金分布图
│   │   ├── DisputerRankingChart.tsx  # 仲裁者排行榜
│   │   └── index.ts
│   ├── details/              # 新增：详情组件
│   │   ├── DisputeDetailPanel.tsx   # 争议详情面板
│   │   ├── DisputerDetailPanel.tsx  # 仲裁者详情面板
│   │   └── index.ts
│   ├── export/               # 新增：导出组件
│   │   ├── ExportButton.tsx         # 复用 deviation 组件
│   │   └── index.ts
│   ├── onboarding/           # 新增：引导组件
│   │   ├── WelcomeGuide.tsx
│   │   ├── HelpTooltip.tsx
│   │   └── index.ts
│   └── ...
├── hooks/
│   ├── useDisputeAnalytics.ts      # 扩展筛选逻辑
│   ├── useTimeRange.ts             # 复用 deviation hook
│   ├── useProtocolChainFilter.ts   # 新增
│   └── ...
```

### 性能优化
- 使用虚拟滚动处理大数据量列表
- 图表数据分片加载
- 缓存筛选结果
- 懒加载详情面板

---

## 实现优先级

### P0 - 核心功能（必须实现）
1. 时间范围选择器（复用现有组件）
2. 协议/链筛选功能
3. 争议详情弹窗/面板

### P1 - 重要功能（应该实现）
4. 争议结果分布可视化
5. 保证金分析图表
6. 仲裁者排行榜增强
7. 多格式数据导出

### P2 - 增强功能（可以实现）
8. 新手引导系统
9. 争议预测分析

### P3 - 未来功能（暂不实现）
10. 实时告警设置
