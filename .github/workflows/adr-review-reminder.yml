name: ADR Review Reminder

on:
  schedule:
    # æ¯æœˆ 1 å·è¿è¡Œ
    - cron: '0 0 1 * *'
  workflow_dispatch:

jobs:
  check-adr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check ADR files
        id: check-adr
        run: |
          echo "Checking ADR files..."
          ADR_COUNT=$(find docs/adr -name "*.md" -not -name "README.md" | wc -l)
          echo "Found $ADR_COUNT ADR files"
          echo "adr_count=$ADR_COUNT" >> $GITHUB_OUTPUT

      - name: Create ADR review issue
        uses: actions/github-script@v7
        with:
          script: |
            const title = `ðŸ“‹ Monthly ADR Review - ${new Date().toISOString().split('T')[0]}`;
            const body = `## ADR æœˆåº¦å®¡æŸ¥æé†’

è¿™æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ ADR å®¡æŸ¥æé†’ã€‚

### å½“å‰çŠ¶æ€
- ADR æ€»æ•°: ${{ steps.check-adr.outputs.adr_count }}
- å®¡æŸ¥æ—¥æœŸ: ${new Date().toISOString().split('T')[0]}

### å®¡æŸ¥æ¸…å•

è¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] æ‰€æœ‰ ADR çŠ¶æ€æ˜¯å¦å‡†ç¡®ï¼ˆæè®®ä¸­/å·²æŽ¥å—/å·²å¼ƒç”¨/å·²å–ä»£ï¼‰
- [ ] æ˜¯å¦æœ‰éœ€è¦æ›´æ–°çš„ ADR
- [ ] æ˜¯å¦æœ‰éœ€è¦æ–°å¢žçš„ ADRï¼ˆè®°å½•æœ€è¿‘çš„æž¶æž„å†³ç­–ï¼‰
- [ ] ADR ç´¢å¼•ï¼ˆREADME.mdï¼‰æ˜¯å¦æœ€æ–°
- [ ] æ˜¯å¦æœ‰å·²å¼ƒç”¨çš„ ADR éœ€è¦æ¸…ç†

### æœ€è¿‘å˜æ›´

è¯·æŸ¥çœ‹æœ€è¿‘çš„æäº¤ï¼Œç¡®è®¤æ˜¯å¦æœ‰éœ€è¦è®°å½•çš„æž¶æž„å†³ç­–ã€‚

### ç›¸å…³é“¾æŽ¥

- [ADR ç›®å½•](../docs/adr/)
- [ADR ç´¢å¼•](../docs/adr/README.md)

---
*æ­¤ Issue ç”± GitHub Actions è‡ªåŠ¨ç”Ÿæˆ*
`;

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ ‡é¢˜çš„ open issue
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              creator: 'github-actions[bot]'
            });

            const exists = issues.data.find(issue => issue.title === title);
            if (exists) {
              console.log('ADR review issue already exists:', exists.html_url);
              return;
            }

            // åˆ›å»ºæ–° issue
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['documentation', 'adr', 'maintenance']
            });

            console.log('Created ADR review issue');
